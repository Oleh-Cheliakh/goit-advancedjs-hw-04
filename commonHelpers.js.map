{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst searchForm = document.querySelector('.search-form');\nconst galleryContainer = document.querySelector('.gallery');\nconst buttonLoadMore = document.querySelector('.load-more');\n\nlet currentPage = 0;\nlet currentQuery;\nlet totalPages = 0;\nlet lightbox;\n\nfunction handleSubmit(event, contentContainer, buttonMore) {\n  event.preventDefault();\n\n  contentContainer.innerHTML = '';\n\n  // buttonMore.classList.add('hidden');\n\n  const formValue = new FormData(event.currentTarget);\n  const { searchQuery } = Object.fromEntries(formValue.entries());\n\n  currentPage += 1;\n\n  if (currentQuery !== searchQuery.toLowerCase()) {\n    currentQuery = searchQuery.toLowerCase();\n    currentPage = 1;\n  }\n\n  getPhotos(currentQuery, currentPage)\n    .then(data => {\n      if (data.hits.length === 0) {\n        showMessage(\n          'Sorry, there are no images matching your search query. Please try again.',\n          'red'\n        );\n        return;\n      }\n      if (currentPage === 1) {\n        totalPages = Math.ceil(data.totalHits / 40);\n        showMessage(`Hooray! We found ${data.totalHits} images.`, 'green');\n      }\n\n      if (totalPages > currentPage) {\n        // buttonMore.classList.remove('hidden');\n        infiniteScroll(buttonLoadMore);\n      }\n\n      createMarkup(data.hits, galleryContainer);\n\n      lightbox = new SimpleLightbox('.photo-card a');\n    })\n    .catch(error => {\n      console.log(error.message);\n    });\n}\n\nsearchForm.addEventListener('submit', event => {\n  handleSubmit(event, galleryContainer, buttonLoadMore);\n});\n\nfunction createMarkup(data, container) {\n  const markup = data\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `<div class=\"photo-card\">\n          <a href=${largeImageURL}>\n            <img src=${webformatURL} alt='${tags}' loading=\"lazy\" width=\"300\" height=\"200\" />\n          </a>\n          <div class=\"info\">\n              <p class=\"info-item\">\n                <b>Likes</b>\n                ${likes}\n              </p>\n              <p class=\"info-item\">\n                <b>Views</b>\n                ${views}\n              </p>\n              <p class=\"info-item\">\n                  <b>Comments</b>\n                  ${comments}\n              </p>\n              <p class=\"info-item\">\n                  <b>Downloads</b>\n                  ${downloads}\n              </p>\n          </div>\n        </div>`;\n      }\n    )\n    .join('');\n\n  container.insertAdjacentHTML('beforeend', markup);\n}\n\nfunction showMessage(message, color) {\n  return iziToast.show({\n    message: `${message}`,\n    color: `${color}`,\n    position: 'topRight',\n    transitionIn: 'fadeInDown',\n  });\n}\n\nfunction loadMore(entries, observer) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      currentPage += 1;\n\n      getPhotos(currentQuery, currentPage)\n        .then(data => {\n          createMarkup(data.hits, galleryContainer);\n          lightbox.refresh();\n          slowScroll();\n          if (totalPages <= currentPage) {\n            // buttonLoadMore.classList.add('hidden');\n            showMessage(\n              \"We're sorry, but you've reached the end of search results.\",\n              'red'\n            );\n            return;\n          }\n        })\n        .catch(error => {\n          console.log(error.message);\n        });\n    }\n  });\n}\n\nasync function getPhotos(query, page) {\n  const API_KEY = '42008350-fb6f0dd148ae0c7c4d4cd1d49';\n\n  const responseAPI = await axios.get('https://pixabay.com/api/', {\n    params: {\n      key: API_KEY,\n      q: `${query}`,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      per_page: 40,\n      page: `${page}`,\n    },\n  });\n\n  const { totalHits, hits } = await responseAPI.data;\n\n  return {\n    totalHits,\n    hits,\n  };\n}\n\nfunction slowScroll() {\n  const { height: cardHeight } = document\n    .querySelector('.gallery')\n    .firstElementChild.getBoundingClientRect();\n\n  window.scrollBy({\n    top: cardHeight * 2,\n    behavior: 'smooth',\n  });\n}\n\nfunction infiniteScroll(target) {\n  let observer = new IntersectionObserver(loadMore, {\n    rootMargin: '0px',\n  });\n\n  observer.observe(target);\n}\n"],"names":["searchForm","galleryContainer","buttonLoadMore","currentPage","currentQuery","totalPages","lightbox","handleSubmit","event","contentContainer","buttonMore","formValue","searchQuery","getPhotos","data","showMessage","infiniteScroll","createMarkup","SimpleLightbox","error","container","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","message","color","iziToast","loadMore","entries","observer","entry","slowScroll","query","page","API_KEY","responseAPI","axios","totalHits","hits","cardHeight","target"],"mappings":"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"}